<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Member">
	<resultMap type="Member" id="memberMap">
		<id column="member_idx" property="memberIdx" />
		<result column="member_id" property="memberId" />
		<result column="member_pass" property="memberPass" />
		<result column="member_name" property="memberName" />
		<result column="local_address" property="localAddress" />
		<result column="detail_address" property="detailAddress" />
		<result column="phone_no" property="phoneNo" />
		<result column="email" property="email" />
		<result column="profile_image" property="profileImage" />
		<result column="regdate" property="regdate" />

		<association property="businessMember" column="member_idx"
			javaType="BusinessMember" select="BusinessMember.selectByMember" />
	</resultMap>

	<select id="selectByIdx" resultType="Member" parameterType="int">
		select * from member where member_idx=#{memberIdx}
	</select>

	<select id="selectById" resultType="Member"
		parameterType="String">
		select * from member where member_id=#{memberId}
	</select>

	<select id="selectByLogin" resultMap="memberMap"
		parameterType="Member">
		select * from member where member_id=#{memberId} and
		member_pass=#{memberPass}
	</select>

	<select id="selectByOauthLogin" resultMap="memberMap"
		parameterType="Member">
		select * from member where member_id=#{memberId} and
		member_name=#{memberName}
	</select>

	<insert id="insert" parameterType="Member">
		insert into member(member_id, member_pass, member_name, local_address,
		detail_address, phone_no, email, profile_image)
		values(#{memberId},
		#{memberPass}, #{memberName}, #{localAddress},
		#{detailAddress},
		#{phoneNo}, #{email}, #{profileImage})
		<selectKey keyColumn="member_idx" keyProperty="memberIdx"
			order="AFTER" resultType="int">
			select last_insert_id() as member_idx
		</selectKey>
	</insert>

	<update id="update" parameterType="Member">
		update member
		<set>
			<if test="memberPass != null">member_pass=#{memberPass}, </if>
			<if test="memberName != null">member_name=#{memberName}, </if>
			<if test="localAddress != null">local_address=#{localAddress}, </if>
			<if test="detailAddress != null">detail_address=#{detailAddress}, </if>
			<if test="phoneNo != null">phone_no=${phoneNo}, </if>
			<if test="email != null">email=#{email}, </if>
			<if test="profileImage != null">profile_image=#{profileImage}</if>
		</set>
		where member_idx=#{memberIdx}
	</update>
</mapper>